# ë”°ë°°ì¿  5-2 [libenessProbeë¥¼ ì´ìš©í•´ì„œ Self-healing Pod ë§Œë“¤ê¸°]

## livenessProbeë¥¼ ì´ìš©í•´ì„œ Self-healing Pod ë§Œë“¤ê¸°

---

### Self-healing

ì»¨í…Œì´ë„ˆê°€ ì œëŒ€ë¡œ ë™ì‘ ë˜ì§€ ëª»í•  ë•Œ (fail) ì¬ì‹œì‘(restart)í•´ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

ì¦‰, ê±´ê°•í•œ ì»¨í…Œì´ë„ˆë“¤ë§Œ ê°€ì§€ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ë¥¼ í•˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[Official self-healing docs](https://kubernetes.io/ko/docs/concepts/workloads/controllers/replicationcontroller/#%EB%A0%88%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC%EC%9D%98-%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D)

Self-healing ì•ˆì— í¬í•¨ëœ ê²ƒì´ ë°”ë¡œ **livenessProbe**ì…ë‹ˆë‹¤.

### Liveness Probe (1)

![Untitled](asset/5-2-0.png)

Podê°€ ê³„ì† ì‹¤í–‰í•  ìˆ˜ ìˆìŒì„ ë³´ì¥í•©ë‹ˆë‹¤.

Podì˜ specì— ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- livenessProbe:     #Podê°€ Runnning ì¤‘ì¼ ë•Œ livenessProbeë¥¼ í†µí•´ ê±´ê°•ê²€ì§„ì„ í•˜ê² ë‹¤ëŠ” ì˜ë¯¸
    - httpGet:        # livenessProbeì¤‘ì—ì„œë„ httpGet Probeë¡œ í•˜ê² ë‹¤.
        - path: /
        - port: 80  # 80í¬íŠ¸ë¡œ ì ‘ì†í•´ì„œ ì˜ ëŒì•„ê°€ê³  ìˆëŠ”ì§€ ì ê²€í•˜ê² ë‹¤.

> ë°°ê°€ ì•„í”„ë©´ ì•ˆê³¼ë¥¼ ê°€ì§€ ë§ê³  ë‚´ê³¼ë¥¼ ê°€ì.
ì›¹ ì„œë¹„ìŠ¤ëŠ” ì›¹ Probë¡œ ì ê²€í•˜ì.
> 

### Liveness Probe (2)

- httpGet Probe [ì›¹ ì„œë¹„ìŠ¤ ë³‘ì›]
    
    ![Untitled](asset/5-2-1.png)
    
    - ì§€ì •í•œ IPì£¼ì†Œ, port, pathì— HTTP GET ìš”ì²­ì„ ë³´ë‚´, í•´ë‹¹ ì»¨í…Œì´ë„ˆê°€ ì‘ë‹µ í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•œë‹¤.
    - ë°˜í™˜ ì½”ë“œê°€ **200ì´ ì•„ë‹Œ ê°’ì´ ë‚˜ì˜¤ë©´** ì˜¤ë¥˜, **ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘**í•œë‹¤.
        - **ì—°ì† ì„¸ ë²ˆ** 200ì´ ì•„ë‹Œ ê°’ì´ ë‚˜ì˜¤ë©´ ê±´ê°•í•˜ì§€ ì•Šë‹¤ê³  íŒë‹¨.
            - í˜„ì¬ ì»¨í…Œì´ë„ˆë¥¼ ì£½ì´ê³  Hubì—ì„œ ë‹¤ìš´ ë°›ì€ ìƒˆë¡œìš´ (ê±´ê°•í•œ) ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰
- tcpSocket Probe [ssh ì„œë¹„ìŠ¤ ë³‘ì›]
    
    ![Untitled](asset/5-2-2.png)
    
    - ì§€ì •ëœ portì— TCP ì—°ê²°ì„ ì‹œë„, **ì—°ê²°ë˜ì§€ ì•Šìœ¼ë©´ ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘**í•œë‹¤.
    - 22ë²ˆìœ¼ë¡œ ì ‘ì† í–ˆì„ ë•Œ ì ‘ì†ì´ ë˜ë©´ ê±´ê°•í•˜êµ¬ë‚˜.
- exec Probe
    
    ![Untitled](asset/5-2-3.png)
    
    - exec ëª…ë ¹ì„ ì „ë‹¬í•˜ê³  ëª…ë ¹ì˜ ì¢…ë£Œì½”ë“œê°€ **0ì´ ì•„ë‹ˆë©´ ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ ì‹œì‘**í•œë‹¤.
    - ì˜ˆì‹œ
        
        > ë°±ì—”ë“œì˜ ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° íŠ¹ì • ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì„œë¹„ìŠ¤í•˜ëŠ” ì»¨í…Œì´ë„ˆê°€ ìˆë‹¤.
        > 
        
        ì»¨í…Œì´ë„ˆ ì•ˆì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ Podê°€ í™•ì¸í•´ì•¼ í•¨.
        
        ì¦‰, ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì‹¤í–‰í•  (ê±´ê°• ê²€ì§„í•  ìˆ˜ ìˆëŠ”) ëª…ë ¹ì–´ë¥¼ ëª…ì‹œ
        

<aside>
ğŸ’¡ ì„¤ì‚¬ ì»¨í…Œì´ë„ˆê°€ Restartë˜ë”ë¼ë„ IPëŠ” ìœ ì§€ëœë‹¤!

</aside>

### Liveness Probe (3)

![Untitled](asset/5-2-4.png)

- liveness probe ë§¤ê°œ ë³€ìˆ˜
    - periodSeconds : health check ë°˜ë³µ ì‹¤í–‰ ì‹œê°„ (ì´ˆ)
        - default : 10 sec
    - initalDelaySeconds : Pod ì‹¤í–‰ í›„ delayí•  ì‹œê°„ (ì´ˆ)
        - default : 0 sec
    - timeoutSeconds : health checkí›„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ (ì´ˆ)
        - default : 1 sec